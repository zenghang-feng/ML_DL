基于Python的基础数据结构，动手实现一个基于概率模型的异常检测算法；  

# 1.算法描述：

## 1.1 假设：

各个维度的特征分别服从正态分布，且各个维度的特征是独立的。

## 1.2 检测方法：

定义一个超参数 ε, 作为判断条件；

构建如下概率模型进行异常检测：

![i](https://github.com/zenghang-feng/ML_DL/blob/main/机器学习-07-异常检测算法/pic1.png)

p(x) ＞ ε，则是正常样本；
p(x) ＜ ε，则是异常样本；

## 1.3 特征处理：

因为对特征的要求是各个维度的特征尽量是正态分布，所以如果不是正态分布，则转化成正态分布；转换的方式有取对数，进行幂计算等。  

对于本文异常检测算法来说，构建合适的特征至关重要。

## 1.4 对检测方法的评估

假设有8000个正常样本，20个异常样本：  

训练集：6000个正常样本；

交叉验证集：1000个正常样本、10个异常样本；

测试集：1000个正常样本、10个异常样本；  

训练好样本之后，通过交叉验证集调整参数 ε ，再用测试集测试效果。

# 2. 程序实现

```
import numpy as np
import matplotlib.pyplot as plt


#################################################################
# 生成二维正态分布的数据，正常数据
#################################################################
sample_nums = 100
x1 = np.random.normal(loc=10, scale=2, size=sample_nums)  # 第一个维度的特征
x2 = np.random.normal(loc=8, scale=1, size=sample_nums)  # 第二个维度的特征


#################################################################
# 定义正态概率密度函数
#################################################################
def norm_distribute(x, mean, std):
    """
    :param x: 随机变量取值，是一个标量数值
    :return: 概率密度函数对应的取值，是一个标量数值
    """
    return (1 / (np.power(2 * np.pi, 0.5) * std)) * np.power(np.e, -(np.power(x - mean, 2)) / (2 * np.power(std, 2)))


#################################################################
# 定义概率模型和异常检测算法
#################################################################
# 分别计算两个维度数据的均值，方差，定义正态分布概率密度 ==================
mean_x1 = np.mean(x1)
std_x1 = np.std(x1)
mean_x2 = np.mean(x2)
std_x2 = np.std(x2)


# 根据概率独立性假设，定义概率模型 ====================================
def p_x(x_1, x_2):
    """
    :param x_1: 第一个维度特征的数值
    :param x_2: 第二个维度特征的数值
    :return: （x_1,x_2）出现的概率
    """
    return norm_distribute(x_1, mean_x1, std_x1) * norm_distribute(x_2, mean_x2, std_x2)


# 通过正样本中最小的p_x定义 ε =======================================
e = 1
for i in range(sample_nums):
    px = p_x(x1[i], x2[i])
    if px < e:
        e = px


# 定义异常检测算法 =================================================
def anomaly_detection(e, pos=(0, 0)):
    """
    :param e: 判断是否异常的最小概率值
    :param pos: 样本点的坐标
    :return: 是否是异常的标签和对应的概率，0代表正常，1代表异常
    """
    px = p_x(pos[0], pos[1])
    if px >= e:
        return 0, px
    else:
        return 1, px


# 给定一个新样本，计算数据产生的概率px，进行异常检测 ======================
x_new, y_new = 13, 15
res, px = anomaly_detection(e, pos=(x_new, y_new))
print(res, px)

#################################################################
# 数据可视化样本点
#################################################################
plt.scatter(x=x1, y=x2)
plt.scatter(x=[x_new], y=[y_new], c='red', s=100)

plt.show()

```

可视化样本点如下：

![i](https://github.com/zenghang-feng/ML_DL/blob/main/机器学习-07-异常检测算法/pic2.png)
